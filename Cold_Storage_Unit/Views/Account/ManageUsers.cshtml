@model Tuple<Cold_Storage_Unit.Models.LoginViewModel, List<Cold_Storage_Unit.Models.LoginViewModel>>
@{
    ViewBag.Title = "Banana Cold Storage";
    var userModel = Model.Item1;
    var userList = Model.Item2;
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
@{
    string userRole = Session["UserRole"]?.ToString();
    string loggedInUser = Session["Username"]?.ToString();
}
<style>
    .custom-shadow {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        border: 2px solid #dee2e6;
    }
</style>

<h2>Manage Users</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

@if (userRole == "admin")
{
    <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#userModal" onclick="openAddForm()">Add User</button>
}
<div class="table-responsive shadow p-3 rounded h-auto container">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Username</th>
                <th>Name</th>
                <th>Surname</th>
                <th>Email</th>
                @if (userRole == "admin")
                {
                    <th>Actions</th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var user in userList)
            {
                <tr>
                    <td>@user.Username</td>
                    <td>@user.Name</td>
                    <td>@user.Surname</td>
                    <td>@user.Email</td>

                    @if (userRole == "admin")
                    {
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="openEditForm('@user.Username')">Edit</button>
                            <a href="@Url.Action("Delete", "Account", new { username = user.Username })" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure to delete?');">Delete</a>
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">User Form</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="userFormContainer">
                        <!-- Form will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <script>
    function openAddForm() {
        $.get('@Url.Action("Register", "Account")', function (data) {
            $('#userFormContainer').html(data);
            $('#userModalLabel').text("Add New User");
        });
    }

    function openEditForm(username) {
        $.get('@Url.Action("Edit", "Account")', { username: username }, function (data) {
            $('#userFormContainer').html(data);
            $('#userModalLabel').text("Edit User");
            $('#userModal').modal('show');
        });
    }
        </script>
    }
